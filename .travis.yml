sudo: false
language: node_js
node_js:
  - "4.1.1"
addons:
  apt:
    packages:
    - libav-tools
#    - x11-apps
#    - ffmpeg
#    - xdotool
  firefox: "38.0"
before_install:
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16"
#  - sh -e /etc/init.d/xvfb start
  - export DISPLAY=:99.0
#  - xdotool mousemove 100 200
before_script:
  - "npm install -g gulp"
  - "avconv -f x11grab -r 25 -s 1280x1024 -i :99.0 -threads 4 $HOME/output.mpg &"
#  - "ffmpeg -video_size 1280x1024 -framerate 25 -f x11grab -i :99.0 output.mpg &"
script: gulp
after_script:
#  - export GH_TOKEN=edf8f71e6062474590f823ad7dea02894d502e63
  - git config --global user.email "travis@travis-ci.org"
  - git config --global user.name "Travis"
  - mkdir gh-pages
  - cd gh-pages
  - git init
  - git remote add origin https://${GH_TOKEN}@github.com/zzo/zzo.github.io.git > /dev/null
  - git checkout -B gh-pages
  - cp $HOME/output.mpg .
  - git add output.mpg
  - ls -l output.mpg
  - git commit -m "video updated"
  - git push origin gh-pages -fq > /dev/null
